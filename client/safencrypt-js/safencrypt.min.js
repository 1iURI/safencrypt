function SAES(){}function encryptSendData(i,t){function r(t){console.log("%c [Safencrypt Monitor] "+t+" -  %c √ Safencrypt已对本次请求进行安全保护 ^_^ %O","font-size:16px;color:rgba(22,119,210,255);","font-size:12px;color:rgba(9,187,7,255)",i)}var e=new Safencrypt,n=localStorage[e.CTOKEN_STORAGE_NAME],o=localStorage[e.IDENTIFIER_STORAGE_NAME],s=localStorage[e.UTOKEN_STORAGE_NAME];if(i.indexOf(safencrypt_config.apply_public_key_url)>=0)r("监测到【申请公钥串】的请求");else if(i.indexOf(safencrypt_config.sign_up_client_url)>=0)r("监测到【注册客户端】的请求");else{if(function(i){for(var t=0;t<safencrypt_config.base_on_client_urls.length;t++){var r=safencrypt_config.base_on_client_urls[t];if(i.indexOf(r)>=0)return!0}return!1}(i))return r("监测到【基于客户端】的请求"),a="type="+e.REQ_TYPE_BASED_CLIENT+"&flag="+n+"&data="+encodeURIComponent(SAES.encrypt(t,o));if(function(i){for(var t=0;t<safencrypt_config.non_encrypt_urls.length;t++){var r=safencrypt_config.non_encrypt_urls[t];if(i.indexOf(r)>=0)return!0}return!1}(i))return a;var a="tyoe="+e.REQ_TYPE_BASED_USER+"&flag="+n+"&data="+encodeURIComponent(SAES.encrypt(t,s))}return t}function decryptResponse(i){i=JSON.parse(i);var t=new Safencrypt,r=(localStorage[t.CTOKEN_STORAGE_NAME],localStorage[t.IDENTIFIER_STORAGE_NAME]);return 3===i.type?SAES.decrypt(i.data,r):i}function Safencrypt(){this.CTOKEN_STORAGE_NAME="safencrypt_ctoken",this.IDENTIFIER_STORAGE_NAME="safencrypt_identifier",this.UTOKEN_STORAGE_NAME="safencrypt_utoken";var i=this;this.REQ_TYPE_BASED_CLIENT=3,this.REQ_TYPE_BASED_USER=4,this.applyPublicKey=function(t){this.log("正在向服务器端申请公钥..."),$.ajax({url:safencrypt_config.apply_public_key_url,type:"GET",data:{type:1},success:function(r){i.log("获取公钥成功，FLAG = "+r.flag),t(r.modulus,r.exponent,r.flag)},error:function(t){i.error("获取公钥失败，无法连接至服务器端")}})},this.signUpClient=function(t,r){this.log("准备向服务器端注册当前浏览器客户端..."),this.applyPublicKey(function(t,e,n){i.log("开始向服务器端发起注册客户端请求...");var o=SRSA.getKeyPair(e,"",t),s=SRSA.encryptedString(o,i.getIdentifier());$.ajax({url:safencrypt_config.sign_up_client_url,type:"POST",data:{type:2,flag:n,data:s},success:function(t){var r=JSON.parse(SAES.decrypt(t.data,i.getIdentifier()));localStorage[i.CTOKEN_STORAGE_NAME]=r.ctoken,i.log("注册服务器端成功，CTOKEN = "+r.ctoken+"。激活【注册客户端成功】回调函数")},error:function(t){i.error("注册客户端失败，无法连接到服务器端。激活【注册客户端失败】回调函数"),r()}})})},this.getIdentifier=function(){var t=localStorage[i.IDENTIFIER_STORAGE_NAME];return(void 0===t||t.length<=0)&&(t="xxxxxxxxxxxxxxxx".replace(/[xy]/g,function(i){var t=16*Math.random()|0;return("x"===i?t:3&t|8).toString(16)}),i.log("创建新的浏览器标识："+t)),localStorage[i.IDENTIFIER_STORAGE_NAME]=t,t},this.checkCToken=function(){var t=localStorage[i.CTOKEN_STORAGE_NAME];return void 0!==t&&t.length>0},this.log=function(i){console.log("%c [Safencrypt] "+i,"font-size:20px;color:#228B22;")},this.error=function(i){console.log("%c [Safencrypt] "+i,"font-size:20px;color:red;")}}SAES.aesEncrypt=function(i,t,r){var e=CryptoJS.enc.Utf8.parse(i),n=CryptoJS.enc.Utf8.parse(t),o=CryptoJS.enc.Utf8.parse(r),s=CryptoJS.AES.encrypt(e,n,{iv:o,mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Iso10126});return CryptoJS.enc.Base64.stringify(s.ciphertext)},SAES.encrypt=function(i,t){return this.aesEncrypt(i,t,t)},SAES.aesDecrypt=function(i,t,r){var e=CryptoJS.enc.Utf8.parse(t),n=CryptoJS.enc.Utf8.parse(r);return CryptoJS.AES.decrypt(i,e,{iv:n,mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Iso10126}).toString(CryptoJS.enc.Utf8)},SAES.decrypt=function(i,t){return this.aesDecrypt(i,t,t)},function(i){i.safencrypt_ajax_inject=function(i){function t(i){return function(){return this.hasOwnProperty(i+"_")?this[i+"_"]:this.xhr[i]}}function r(t){return function(r){var e=this.xhr,n=this;0==t.indexOf("on")?i[t]?e[t]=function(){i[t](n)||r.apply(e,arguments)}:e[t]=r:this[t+"_"]=r}}function e(t){return function(){var r=[].slice.call(arguments);if(!i[t]||!i[t].call(this,r,this.xhr))return this.xhr[t].apply(this.xhr,r)}}return window._ahrealxhr=window._ahrealxhr||XMLHttpRequest,XMLHttpRequest=function(){this.xhr=new window._ahrealxhr;for(var i in this.xhr){var n="";try{n=typeof this.xhr[i]}catch(i){}"function"===n?this[i]=e(i):Object.defineProperty(this,i,{get:t(i),set:r(i)})}},window._ahrealxhr},i.unHookAjax=function(){window._ahrealxhr&&(XMLHttpRequest=window._ahrealxhr),window._ahrealxhr=void 0}}(window),function(i){XMLHttpRequest.prototype.send=function(t){this.setRequestHeader("content-type","application/x-www-form-urlencoded;charset=utf-8"),i.call(this,encryptSendData(this.safencrypt_url,t))}}(XMLHttpRequest.prototype.send),safencrypt_ajax_inject({onload:function(i){i.responseText=decryptResponse(i.responseText)},open:function(i,t){t.safencrypt_url=i[1]}}),function(t){function r(i){var t=o,r=t.biDivideByRadixPower(i,this.k-1),e=t.biMultiply(r,this.mu),n=t.biDivideByRadixPower(e,this.k+1),s=t.biModuloByRadixPower(i,this.k+1),a=t.biMultiply(n,this.modulus),g=t.biModuloByRadixPower(a,this.k+1),u=t.biSubtract(s,g);u.isNeg&&(u=t.biAdd(u,this.bkplus1));for(var d=t.biCompare(u,this.modulus)>=0;d;)u=t.biSubtract(u,this.modulus),d=t.biCompare(u,this.modulus)>=0;return u}function e(i,t){var r=o.biMultiply(i,t);return this.modulo(r)}function n(i,t){var r=new d;r.digits[0]=1;for(var e=i,n=t;;){if(0!=(1&n.digits[0])&&(r=this.multiplyMod(r,e)),0==(n=o.biShiftRight(n,1)).digits[0]&&0==o.biHighIndex(n))break;e=this.multiplyMod(e,e)}return r}if(void 0===t.SRSA)var o=t.SRSA={};var s,a,g,u,d=t.BigInt=function(i){this.digits="boolean"==typeof i&&1==i?null:a.slice(0),this.isNeg=!1};o.setMaxDigits=function(i){s=i,a=new Array(s);for(var t=0;t<a.length;t++)a[t]=0;g=new d,(u=new d).digits[0]=1},o.setMaxDigits(20);o.biFromNumber=function(i){var t=new d;t.isNeg=i<0,i=Math.abs(i);for(var r=0;i>0;)t.digits[r++]=65535&i,i=Math.floor(i/65536);return t};var c=o.biFromNumber(1e15);o.biFromDecimal=function(i){for(var t,r="-"==i.charAt(0),e=r?1:0;e<i.length&&"0"==i.charAt(e);)++e;if(e==i.length)t=new d;else{var n=(i.length-e)%15;for(0==n&&(n=15),t=o.biFromNumber(Number(i.substr(e,n))),e+=n;e<i.length;)t=o.biAdd(o.biMultiply(t,c),o.biFromNumber(Number(i.substr(e,15)))),e+=15;t.isNeg=r}return t},o.biCopy=function(i){var t=new d(!0);return t.digits=i.digits.slice(0),t.isNeg=i.isNeg,t},o.reverseStr=function(i){for(var t="",r=i.length-1;r>-1;--r)t+=i.charAt(r);return t};var f=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"];o.biToString=function(i,t){var r=new d;r.digits[0]=t;for(var e=o.biDivideModulo(i,r),n=f[e[1].digits[0]];1==o.biCompare(e[0],g);)e=o.biDivideModulo(e[0],r),digit=e[1].digits[0],n+=f[e[1].digits[0]];return(i.isNeg?"-":"")+o.reverseStr(n)},o.biToDecimal=function(i){var t=new d;t.digits[0]=10;for(var r=o.biDivideModulo(i,t),e=String(r[1].digits[0]);1==o.biCompare(r[0],g);)r=o.biDivideModulo(r[0],t),e+=String(r[1].digits[0]);return(i.isNeg?"-":"")+o.reverseStr(e)};var l=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];o.digitToHex=function(t){var r="";for(i=0;i<4;++i)r+=l[15&t],t>>>=4;return o.reverseStr(r)},o.biToHex=function(i){for(var t="",r=(o.biHighIndex(i),o.biHighIndex(i));r>-1;--r)t+=o.digitToHex(i.digits[r]);return t},o.charToHex=function(i){return i>=48&&i<=57?i-48:i>=65&&i<=90?10+i-65:i>=97&&i<=122?10+i-97:0},o.hexToDigit=function(i){for(var t=0,r=Math.min(i.length,4),e=0;e<r;++e)t<<=4,t|=o.charToHex(i.charCodeAt(e));return t},o.biFromHex=function(i){for(var t=new d,r=i.length,e=0;r>0;r-=4,++e)t.digits[e]=o.hexToDigit(i.substr(Math.max(r-4,0),Math.min(r,4)));return t},o.biFromString=function(i,t){var r="-"==i.charAt(0),e=r?1:0,n=new d,s=new d;s.digits[0]=1;for(var a=i.length-1;a>=e;a--){var g=i.charCodeAt(a),u=o.charToHex(g),c=o.biMultiplyDigit(s,u);n=o.biAdd(n,c),s=o.biMultiplyDigit(s,t)}return n.isNeg=r,n},o.biDump=function(i){return(i.isNeg?"-":"")+i.digits.join(" ")},o.biAdd=function(i,t){var r;if(i.isNeg!=t.isNeg)t.isNeg=!t.isNeg,r=o.biSubtract(i,t),t.isNeg=!t.isNeg;else{r=new d;for(var e,n=0,s=0;s<i.digits.length;++s)e=i.digits[s]+t.digits[s]+n,r.digits[s]=e%65536,n=Number(e>=65536);r.isNeg=i.isNeg}return r},o.biSubtract=function(i,t){var r;if(i.isNeg!=t.isNeg)t.isNeg=!t.isNeg,r=o.biAdd(i,t),t.isNeg=!t.isNeg;else{r=new d;var e,n;n=0;for(s=0;s<i.digits.length;++s)e=i.digits[s]-t.digits[s]+n,r.digits[s]=e%65536,r.digits[s]<0&&(r.digits[s]+=65536),n=0-Number(e<0);if(-1==n){n=0;for(var s=0;s<i.digits.length;++s)e=0-r.digits[s]+n,r.digits[s]=e%65536,r.digits[s]<0&&(r.digits[s]+=65536),n=0-Number(e<0);r.isNeg=!i.isNeg}else r.isNeg=i.isNeg}return r},o.biHighIndex=function(i){for(var t=i.digits.length-1;t>0&&0==i.digits[t];)--t;return t},o.biNumBits=function(i){var t,r=o.biHighIndex(i),e=i.digits[r],n=16*(r+1);for(t=n;t>n-16&&0==(32768&e);--t)e<<=1;return t},o.biMultiply=function(i,t){for(var r,e,n,s=new d,a=o.biHighIndex(i),g=o.biHighIndex(t),u=0;u<=g;++u){for(r=0,n=u,j=0;j<=a;++j,++n)e=s.digits[n]+i.digits[j]*t.digits[u]+r,s.digits[n]=65535&e,r=e>>>16;s.digits[u+a+1]=r}return s.isNeg=i.isNeg!=t.isNeg,s},o.biMultiplyDigit=function(i,t){var r,e,n;result=new d,r=o.biHighIndex(i),e=0;for(var s=0;s<=r;++s)n=result.digits[s]+i.digits[s]*t+e,result.digits[s]=65535&n,e=n>>>16;return result.digits[1+r]=e,result},o.arrayCopy=function(i,t,r,e,n){for(var o=Math.min(t+n,i.length),s=t,a=e;s<o;++s,++a)r[a]=i[s]};var h=[0,32768,49152,57344,61440,63488,64512,65024,65280,65408,65472,65504,65520,65528,65532,65534,65535];o.biShiftLeft=function(i,t){var r=Math.floor(t/16),e=new d;o.arrayCopy(i.digits,0,e.digits,r,e.digits.length-r);for(var n=t%16,s=16-n,a=e.digits.length-1,g=a-1;a>0;--a,--g)e.digits[a]=e.digits[a]<<n&65535|(e.digits[g]&h[n])>>>s;return e.digits[0]=e.digits[a]<<n&65535,e.isNeg=i.isNeg,e};var p=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535];o.biShiftRight=function(i,t){var r=Math.floor(t/16),e=new d;o.arrayCopy(i.digits,r,e.digits,0,i.digits.length-r);for(var n=t%16,s=16-n,a=0,g=a+1;a<e.digits.length-1;++a,++g)e.digits[a]=e.digits[a]>>>n|(e.digits[g]&p[n])<<s;return e.digits[e.digits.length-1]>>>=n,e.isNeg=i.isNeg,e},o.biMultiplyByRadixPower=function(i,t){var r=new d;return o.arrayCopy(i.digits,0,r.digits,t,r.digits.length-t),r},o.biDivideByRadixPower=function(i,t){var r=new d;return o.arrayCopy(i.digits,t,r.digits,0,r.digits.length-t),r},o.biModuloByRadixPower=function(i,t){var r=new d;return o.arrayCopy(i.digits,0,r.digits,0,t),r},o.biCompare=function(i,t){if(i.isNeg!=t.isNeg)return 1-2*Number(i.isNeg);for(var r=i.digits.length-1;r>=0;--r)if(i.digits[r]!=t.digits[r])return i.isNeg?1-2*Number(i.digits[r]>t.digits[r]):1-2*Number(i.digits[r]<t.digits[r]);return 0},o.biDivideModulo=function(i,t){var r,e,n=o.biNumBits(i),s=o.biNumBits(t),a=t.isNeg;if(n<s)return i.isNeg?((r=o.biCopy(u)).isNeg=!t.isNeg,i.isNeg=!1,t.isNeg=!1,e=biSubtract(t,i),i.isNeg=!0,t.isNeg=a):(r=new d,e=o.biCopy(i)),[r,e];r=new d,e=i;for(var g=Math.ceil(s/16)-1,c=0;t.digits[g]<32768;)t=o.biShiftLeft(t,1),++c,++s,g=Math.ceil(s/16)-1;e=o.biShiftLeft(e,c),n+=c;for(var f=Math.ceil(n/16)-1,l=o.biMultiplyByRadixPower(t,f-g);-1!=o.biCompare(e,l);)++r.digits[f-g],e=o.biSubtract(e,l);for(var h=f;h>g;--h){var p=h>=e.digits.length?0:e.digits[h],b=h-1>=e.digits.length?0:e.digits[h-1],y=h-2>=e.digits.length?0:e.digits[h-2],S=g>=t.digits.length?0:t.digits[g],v=g-1>=t.digits.length?0:t.digits[g-1];r.digits[h-g-1]=p==S?65535:Math.floor((65536*p+b)/S);for(var x=r.digits[h-g-1]*(65536*S+v),N=4294967296*p+(65536*b+y);x>N;)--r.digits[h-g-1],x=r.digits[h-g-1]*(65536*S|v),N=65536*p*65536+(65536*b+y);l=o.biMultiplyByRadixPower(t,h-g-1),(e=o.biSubtract(e,o.biMultiplyDigit(l,r.digits[h-g-1]))).isNeg&&(e=o.biAdd(e,l),--r.digits[h-g-1])}return e=o.biShiftRight(e,c),r.isNeg=i.isNeg!=a,i.isNeg&&(r=a?o.biAdd(r,u):o.biSubtract(r,u),t=o.biShiftRight(t,c),e=o.biSubtract(t,e)),0==e.digits[0]&&0==o.biHighIndex(e)&&(e.isNeg=!1),[r,e]},o.biDivide=function(i,t){return o.biDivideModulo(i,t)[0]},o.biModulo=function(i,t){return o.biDivideModulo(i,t)[1]},o.biMultiplyMod=function(i,t,r){return o.biModulo(o.biMultiply(i,t),r)},o.biPow=function(i,t){for(var r=u,e=i;;){if(0!=(1&t)&&(r=o.biMultiply(r,e)),0==(t>>=1))break;e=o.biMultiply(e,e)}return r},o.biPowMod=function(i,t,r){for(var e=u,n=i,s=t;;){if(0!=(1&s.digits[0])&&(e=o.biMultiplyMod(e,n,r)),0==(s=o.biShiftRight(s,1)).digits[0]&&0==o.biHighIndex(s))break;n=o.biMultiplyMod(n,n,r)}return e},t.BarrettMu=function(i){this.modulus=o.biCopy(i),this.k=o.biHighIndex(this.modulus)+1;var t=new d;t.digits[2*this.k]=1,this.mu=o.biDivide(t,this.modulus),this.bkplus1=new d,this.bkplus1.digits[this.k+1]=1,this.modulo=r,this.multiplyMod=e,this.powMod=n};var b=function(i,r,e){var n=o;this.e=n.biFromHex(i),this.d=n.biFromHex(r),this.m=n.biFromHex(e),this.chunkSize=2*n.biHighIndex(this.m),this.radix=16,this.barrett=new t.BarrettMu(this.m)};o.getKeyPair=function(i,t,r){return new b(i,t,r)},void 0===t.twoDigit&&(t.twoDigit=function(i){return(i<10?"0":"")+String(i)}),o.encryptedString=function(i,t){for(var r=[],e=t.length,n=0;n<e;)r[n]=t.charCodeAt(n),n++;for(;r.length%i.chunkSize!=0;)r[n++]=0;var s,a,g,u=r.length,c="";for(n=0;n<u;n+=i.chunkSize){for(g=new d,s=0,a=n;a<n+i.chunkSize;++s)g.digits[s]=r[a++],g.digits[s]+=r[a++]<<8;var f=i.barrett.powMod(g,i.e);c+=(16==i.radix?o.biToHex(f):o.biToString(f,i.radix))+" "}return c.substring(0,c.length-1)},o.decryptedString=function(i,t){var r,e,n,s=t.split(" "),a="";for(r=0;r<s.length;++r){var g;for(g=16==i.radix?o.biFromHex(s[r]):o.biFromString(s[r],i.radix),n=i.barrett.powMod(g,i.d),e=0;e<=o.biHighIndex(n);++e)a+=String.fromCharCode(255&n.digits[e],n.digits[e]>>8)}return 0==a.charCodeAt(a.length-1)&&(a=a.substring(0,a.length-1)),a},o.setMaxDigits(130)}(window),Safencrypt.startUp=function(i,t){var r=new Safencrypt;r.log("正在启动中...[author:1iURI]"),r.checkCToken()?r.log("启动成功。当前浏览器已经在服务器端注册完毕。"):(r.error("检测到当前浏览器未注册至服务器端，启动客户端注册机制..."),r.signUpClient(i,t))},Safencrypt.saveUToken=function(i){localStorage[(new Safencrypt).UTOKEN_STORAGE_NAME]=i};