function SAES(){}function Safencrypt(){var i=this;this.applyPublicKey=function(t){this.log("正在向服务器端申请公钥..."),$.ajax({url:safencrypt_config.apply_public_key_url,type:"GET",data:{type:1},success:function(r){i.log("获取公钥成功，FLAG = "+r.flag),t(r.modulus,r.exponent,r.flag)},error:function(t){i.error("获取公钥失败，无法连接至服务器端")}})},this.signUpClient=function(t,r){this.log("准备向服务器端注册当前浏览器客户端..."),this.applyPublicKey(function(t,r,e){i.log("开始向服务器端发起注册客户端请求...");var n=SRSA.getKeyPair(r,"",t),o=SRSA.encryptedString(n,i.getIdentifier());console.log("data = "+o),$.ajax({url:safencrypt_config.sign_up_client_url,type:"POST",data:{type:2,flag:e,data:o},success:function(t){console.log("注册客户端，服务器返回了："+SAES.decrypt(t.data,i.getIdentifier()))},error:function(i){}})})},this.getIdentifier=function(){var t=localStorage.safencrypt_identifier;return(void 0===t||t.length<=0)&&(t="xxxxxxxxxxxxxxxx".replace(/[xy]/g,function(i){var t=16*Math.random()|0;return("x"===i?t:3&t|8).toString(16)}),i.log("创建新的浏览器标识："+t)),localStorage.safencrypt_identifier=t,t},this.checkCToken=function(){var i=localStorage.safencrypt_ctoken;return void 0!==i&&i.length>0},this.log=function(i){console.log("%c [Safencrypt] "+i,"font-size:20px;color:#228B22;")},this.error=function(i){console.log("%c [Safencrypt] "+i,"font-size:20px;color:red;")}}SAES.aesEncrypt=function(i,t,r){var e=CryptoJS.enc.Utf8.parse(i),n=CryptoJS.enc.Utf8.parse(t),o=CryptoJS.enc.Utf8.parse(r),s=CryptoJS.AES.encrypt(e,n,{iv:o,mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Iso10126});return CryptoJS.enc.Base64.stringify(s.ciphertext)},SAES.encrypt=function(i,t){return this.aesEncrypt(i,t,t)},SAES.aesDecrypt=function(i,t,r){var e=CryptoJS.enc.Utf8.parse(t),n=CryptoJS.enc.Utf8.parse(r);return CryptoJS.AES.decrypt(i,e,{iv:n,mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Iso10126}).toString(CryptoJS.enc.Utf8)},SAES.decrypt=function(i,t){return this.aesDecrypt(i,t,t)},function(t){function r(i){var t=o,r=t.biDivideByRadixPower(i,this.k-1),e=t.biMultiply(r,this.mu),n=t.biDivideByRadixPower(e,this.k+1),s=t.biModuloByRadixPower(i,this.k+1),g=t.biMultiply(n,this.modulus),d=t.biModuloByRadixPower(g,this.k+1),u=t.biSubtract(s,d);u.isNeg&&(u=t.biAdd(u,this.bkplus1));for(var a=t.biCompare(u,this.modulus)>=0;a;)u=t.biSubtract(u,this.modulus),a=t.biCompare(u,this.modulus)>=0;return u}function e(i,t){var r=o.biMultiply(i,t);return this.modulo(r)}function n(i,t){var r=new a;r.digits[0]=1;for(var e=i,n=t;;){if(0!=(1&n.digits[0])&&(r=this.multiplyMod(r,e)),0==(n=o.biShiftRight(n,1)).digits[0]&&0==o.biHighIndex(n))break;e=this.multiplyMod(e,e)}return r}if(void 0===t.SRSA)var o=t.SRSA={};var s,g,d,u,a=t.BigInt=function(i){this.digits="boolean"==typeof i&&1==i?null:g.slice(0),this.isNeg=!1};o.setMaxDigits=function(i){s=i,g=new Array(s);for(var t=0;t<g.length;t++)g[t]=0;d=new a,(u=new a).digits[0]=1},o.setMaxDigits(20);o.biFromNumber=function(i){var t=new a;t.isNeg=i<0,i=Math.abs(i);for(var r=0;i>0;)t.digits[r++]=65535&i,i=Math.floor(i/65536);return t};var l=o.biFromNumber(1e15);o.biFromDecimal=function(i){for(var t,r="-"==i.charAt(0),e=r?1:0;e<i.length&&"0"==i.charAt(e);)++e;if(e==i.length)t=new a;else{var n=(i.length-e)%15;for(0==n&&(n=15),t=o.biFromNumber(Number(i.substr(e,n))),e+=n;e<i.length;)t=o.biAdd(o.biMultiply(t,l),o.biFromNumber(Number(i.substr(e,15)))),e+=15;t.isNeg=r}return t},o.biCopy=function(i){var t=new a(!0);return t.digits=i.digits.slice(0),t.isNeg=i.isNeg,t},o.reverseStr=function(i){for(var t="",r=i.length-1;r>-1;--r)t+=i.charAt(r);return t};var f=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"];o.biToString=function(i,t){var r=new a;r.digits[0]=t;for(var e=o.biDivideModulo(i,r),n=f[e[1].digits[0]];1==o.biCompare(e[0],d);)e=o.biDivideModulo(e[0],r),digit=e[1].digits[0],n+=f[e[1].digits[0]];return(i.isNeg?"-":"")+o.reverseStr(n)},o.biToDecimal=function(i){var t=new a;t.digits[0]=10;for(var r=o.biDivideModulo(i,t),e=String(r[1].digits[0]);1==o.biCompare(r[0],d);)r=o.biDivideModulo(r[0],t),e+=String(r[1].digits[0]);return(i.isNeg?"-":"")+o.reverseStr(e)};var c=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];o.digitToHex=function(t){var r="";for(i=0;i<4;++i)r+=c[15&t],t>>>=4;return o.reverseStr(r)},o.biToHex=function(i){for(var t="",r=(o.biHighIndex(i),o.biHighIndex(i));r>-1;--r)t+=o.digitToHex(i.digits[r]);return t},o.charToHex=function(i){return i>=48&&i<=57?i-48:i>=65&&i<=90?10+i-65:i>=97&&i<=122?10+i-97:0},o.hexToDigit=function(i){for(var t=0,r=Math.min(i.length,4),e=0;e<r;++e)t<<=4,t|=o.charToHex(i.charCodeAt(e));return t},o.biFromHex=function(i){for(var t=new a,r=i.length,e=0;r>0;r-=4,++e)t.digits[e]=o.hexToDigit(i.substr(Math.max(r-4,0),Math.min(r,4)));return t},o.biFromString=function(i,t){var r="-"==i.charAt(0),e=r?1:0,n=new a,s=new a;s.digits[0]=1;for(var g=i.length-1;g>=e;g--){var d=i.charCodeAt(g),u=o.charToHex(d),l=o.biMultiplyDigit(s,u);n=o.biAdd(n,l),s=o.biMultiplyDigit(s,t)}return n.isNeg=r,n},o.biDump=function(i){return(i.isNeg?"-":"")+i.digits.join(" ")},o.biAdd=function(i,t){var r;if(i.isNeg!=t.isNeg)t.isNeg=!t.isNeg,r=o.biSubtract(i,t),t.isNeg=!t.isNeg;else{r=new a;for(var e,n=0,s=0;s<i.digits.length;++s)e=i.digits[s]+t.digits[s]+n,r.digits[s]=e%65536,n=Number(e>=65536);r.isNeg=i.isNeg}return r},o.biSubtract=function(i,t){var r;if(i.isNeg!=t.isNeg)t.isNeg=!t.isNeg,r=o.biAdd(i,t),t.isNeg=!t.isNeg;else{r=new a;var e,n;n=0;for(s=0;s<i.digits.length;++s)e=i.digits[s]-t.digits[s]+n,r.digits[s]=e%65536,r.digits[s]<0&&(r.digits[s]+=65536),n=0-Number(e<0);if(-1==n){n=0;for(var s=0;s<i.digits.length;++s)e=0-r.digits[s]+n,r.digits[s]=e%65536,r.digits[s]<0&&(r.digits[s]+=65536),n=0-Number(e<0);r.isNeg=!i.isNeg}else r.isNeg=i.isNeg}return r},o.biHighIndex=function(i){for(var t=i.digits.length-1;t>0&&0==i.digits[t];)--t;return t},o.biNumBits=function(i){var t,r=o.biHighIndex(i),e=i.digits[r],n=16*(r+1);for(t=n;t>n-16&&0==(32768&e);--t)e<<=1;return t},o.biMultiply=function(i,t){for(var r,e,n,s=new a,g=o.biHighIndex(i),d=o.biHighIndex(t),u=0;u<=d;++u){for(r=0,n=u,j=0;j<=g;++j,++n)e=s.digits[n]+i.digits[j]*t.digits[u]+r,s.digits[n]=65535&e,r=e>>>16;s.digits[u+g+1]=r}return s.isNeg=i.isNeg!=t.isNeg,s},o.biMultiplyDigit=function(i,t){var r,e,n;result=new a,r=o.biHighIndex(i),e=0;for(var s=0;s<=r;++s)n=result.digits[s]+i.digits[s]*t+e,result.digits[s]=65535&n,e=n>>>16;return result.digits[1+r]=e,result},o.arrayCopy=function(i,t,r,e,n){for(var o=Math.min(t+n,i.length),s=t,g=e;s<o;++s,++g)r[g]=i[s]};var b=[0,32768,49152,57344,61440,63488,64512,65024,65280,65408,65472,65504,65520,65528,65532,65534,65535];o.biShiftLeft=function(i,t){var r=Math.floor(t/16),e=new a;o.arrayCopy(i.digits,0,e.digits,r,e.digits.length-r);for(var n=t%16,s=16-n,g=e.digits.length-1,d=g-1;g>0;--g,--d)e.digits[g]=e.digits[g]<<n&65535|(e.digits[d]&b[n])>>>s;return e.digits[0]=e.digits[g]<<n&65535,e.isNeg=i.isNeg,e};var h=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535];o.biShiftRight=function(i,t){var r=Math.floor(t/16),e=new a;o.arrayCopy(i.digits,r,e.digits,0,i.digits.length-r);for(var n=t%16,s=16-n,g=0,d=g+1;g<e.digits.length-1;++g,++d)e.digits[g]=e.digits[g]>>>n|(e.digits[d]&h[n])<<s;return e.digits[e.digits.length-1]>>>=n,e.isNeg=i.isNeg,e},o.biMultiplyByRadixPower=function(i,t){var r=new a;return o.arrayCopy(i.digits,0,r.digits,t,r.digits.length-t),r},o.biDivideByRadixPower=function(i,t){var r=new a;return o.arrayCopy(i.digits,t,r.digits,0,r.digits.length-t),r},o.biModuloByRadixPower=function(i,t){var r=new a;return o.arrayCopy(i.digits,0,r.digits,0,t),r},o.biCompare=function(i,t){if(i.isNeg!=t.isNeg)return 1-2*Number(i.isNeg);for(var r=i.digits.length-1;r>=0;--r)if(i.digits[r]!=t.digits[r])return i.isNeg?1-2*Number(i.digits[r]>t.digits[r]):1-2*Number(i.digits[r]<t.digits[r]);return 0},o.biDivideModulo=function(i,t){var r,e,n=o.biNumBits(i),s=o.biNumBits(t),g=t.isNeg;if(n<s)return i.isNeg?((r=o.biCopy(u)).isNeg=!t.isNeg,i.isNeg=!1,t.isNeg=!1,e=biSubtract(t,i),i.isNeg=!0,t.isNeg=g):(r=new a,e=o.biCopy(i)),[r,e];r=new a,e=i;for(var d=Math.ceil(s/16)-1,l=0;t.digits[d]<32768;)t=o.biShiftLeft(t,1),++l,++s,d=Math.ceil(s/16)-1;e=o.biShiftLeft(e,l),n+=l;for(var f=Math.ceil(n/16)-1,c=o.biMultiplyByRadixPower(t,f-d);-1!=o.biCompare(e,c);)++r.digits[f-d],e=o.biSubtract(e,c);for(var b=f;b>d;--b){var h=b>=e.digits.length?0:e.digits[b],p=b-1>=e.digits.length?0:e.digits[b-1],y=b-2>=e.digits.length?0:e.digits[b-2],v=d>=t.digits.length?0:t.digits[d],S=d-1>=t.digits.length?0:t.digits[d-1];r.digits[b-d-1]=h==v?65535:Math.floor((65536*h+p)/v);for(var x=r.digits[b-d-1]*(65536*v+S),N=4294967296*h+(65536*p+y);x>N;)--r.digits[b-d-1],x=r.digits[b-d-1]*(65536*v|S),N=65536*h*65536+(65536*p+y);c=o.biMultiplyByRadixPower(t,b-d-1),(e=o.biSubtract(e,o.biMultiplyDigit(c,r.digits[b-d-1]))).isNeg&&(e=o.biAdd(e,c),--r.digits[b-d-1])}return e=o.biShiftRight(e,l),r.isNeg=i.isNeg!=g,i.isNeg&&(r=g?o.biAdd(r,u):o.biSubtract(r,u),t=o.biShiftRight(t,l),e=o.biSubtract(t,e)),0==e.digits[0]&&0==o.biHighIndex(e)&&(e.isNeg=!1),[r,e]},o.biDivide=function(i,t){return o.biDivideModulo(i,t)[0]},o.biModulo=function(i,t){return o.biDivideModulo(i,t)[1]},o.biMultiplyMod=function(i,t,r){return o.biModulo(o.biMultiply(i,t),r)},o.biPow=function(i,t){for(var r=u,e=i;;){if(0!=(1&t)&&(r=o.biMultiply(r,e)),0==(t>>=1))break;e=o.biMultiply(e,e)}return r},o.biPowMod=function(i,t,r){for(var e=u,n=i,s=t;;){if(0!=(1&s.digits[0])&&(e=o.biMultiplyMod(e,n,r)),0==(s=o.biShiftRight(s,1)).digits[0]&&0==o.biHighIndex(s))break;n=o.biMultiplyMod(n,n,r)}return e},t.BarrettMu=function(i){this.modulus=o.biCopy(i),this.k=o.biHighIndex(this.modulus)+1;var t=new a;t.digits[2*this.k]=1,this.mu=o.biDivide(t,this.modulus),this.bkplus1=new a,this.bkplus1.digits[this.k+1]=1,this.modulo=r,this.multiplyMod=e,this.powMod=n};var p=function(i,r,e){var n=o;this.e=n.biFromHex(i),this.d=n.biFromHex(r),this.m=n.biFromHex(e),this.chunkSize=2*n.biHighIndex(this.m),this.radix=16,this.barrett=new t.BarrettMu(this.m)};o.getKeyPair=function(i,t,r){return new p(i,t,r)},void 0===t.twoDigit&&(t.twoDigit=function(i){return(i<10?"0":"")+String(i)}),o.encryptedString=function(i,t){for(var r=[],e=t.length,n=0;n<e;)r[n]=t.charCodeAt(n),n++;for(;r.length%i.chunkSize!=0;)r[n++]=0;var s,g,d,u=r.length,l="";for(n=0;n<u;n+=i.chunkSize){for(d=new a,s=0,g=n;g<n+i.chunkSize;++s)d.digits[s]=r[g++],d.digits[s]+=r[g++]<<8;var f=i.barrett.powMod(d,i.e);l+=(16==i.radix?o.biToHex(f):o.biToString(f,i.radix))+" "}return l.substring(0,l.length-1)},o.decryptedString=function(i,t){var r,e,n,s=t.split(" "),g="";for(r=0;r<s.length;++r){var d;for(d=16==i.radix?o.biFromHex(s[r]):o.biFromString(s[r],i.radix),n=i.barrett.powMod(d,i.d),e=0;e<=o.biHighIndex(n);++e)g+=String.fromCharCode(255&n.digits[e],n.digits[e]>>8)}return 0==g.charCodeAt(g.length-1)&&(g=g.substring(0,g.length-1)),g},o.setMaxDigits(130)}(window),Safencrypt.startUp=function(i,t){var r=new Safencrypt;r.log("正在启动中...[author:1iURI]"),r.checkCToken()||(r.error("检测到当前浏览器未注册至服务器端，启动客户端注册机制..."),r.signUpClient(i,t))};