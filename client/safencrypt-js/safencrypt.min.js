function AESUtils(){}function Safencrypt(){var i=this;this.applyPublicKey=function(t){this.log("正在向服务器端申请公钥..."),$.ajax({url:safencrypt_config.apply_public_key_url,type:"GET",success:function(e){i.log("获取公钥成功，FLAG = "+e.flag),t(e.modulus,e.exponent,e.flag)},error:function(t){i.error("获取公钥失败，无法连接至服务器端")}})},this.signUpClient=function(t,e){this.log("准备向服务器端注册当前浏览器客户端..."),this.applyPublicKey(function(t,e,r){i.log("开始向服务器端发起注册客户端请求...");var n=RSAUtils.getKeyPair(e,"",t),o=RSAUtils.encryptedString(n,i.getIdentifier());$.ajax({url:safencrypt_config.sign_up_client_url,type:"POST",data:{flag:r,data:o},success:function(i){},error:function(i){}})})},this.getIdentifier=function(){var t=i.getCookie("safencrypt_identifier");return(null===t||t.length<=0)&&(t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(i){var t=16*Math.random()|0;return("x"===i?t:3&t|8).toString(16)})),i.setCookie("safencrypt_identifier",t,365),t},this.checkCToken=function(){var i=this.getCookie("safencrypt_ctoken");return null!==i&&i.length>0},this.log=function(i){console.log("%c [Safencrypt] "+i,"font-size:20px;color:#228B22;")},this.error=function(i){console.log("%c [Safencrypt] "+i,"font-size:20px;color:red;")},this.getCookie=function(i){var t,e;return document.cookie.length>0&&-1!==(t=document.cookie.indexOf(i+"="))?(t=t+i.length+1,-1===(e=document.cookie.indexOf(";",t))&&(e=document.cookie.length),unescape(document.cookie.substring(t,e))):""},this.setCookie=function(i,t,e){var r=new Date;r.setDate(r.getDate()+e),document.cookie=i+"="+escape(t)+(null==e?"":";expires="+r.toGMTString())}}AESUtils.encrypt=function(i,t,e){var r=CryptoJS.enc.Utf8.parse(i),n=CryptoJS.enc.Utf8.parse(t),o=CryptoJS.enc.Utf8.parse(e),s=CryptoJS.AES.encrypt(r,n,{iv:o,mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Iso10126});return CryptoJS.enc.Base64.stringify(s.ciphertext)},AESUtils.decrypt=function(i,t,e){var r=CryptoJS.enc.Utf8.parse(t),n=CryptoJS.enc.Utf8.parse(e);return CryptoJS.AES.decrypt(i,r,{iv:n,mode:CryptoJS.mode.CBC,padding:CryptoJS.pad.Iso10126}).toString(CryptoJS.enc.Utf8)},function(t){function e(i){var t=o,e=t.biDivideByRadixPower(i,this.k-1),r=t.biMultiply(e,this.mu),n=t.biDivideByRadixPower(r,this.k+1),s=t.biModuloByRadixPower(i,this.k+1),g=t.biMultiply(n,this.modulus),d=t.biModuloByRadixPower(g,this.k+1),u=t.biSubtract(s,d);u.isNeg&&(u=t.biAdd(u,this.bkplus1));for(var a=t.biCompare(u,this.modulus)>=0;a;)u=t.biSubtract(u,this.modulus),a=t.biCompare(u,this.modulus)>=0;return u}function r(i,t){var e=o.biMultiply(i,t);return this.modulo(e)}function n(i,t){var e=new a;e.digits[0]=1;for(var r=i,n=t;;){if(0!=(1&n.digits[0])&&(e=this.multiplyMod(e,r)),0==(n=o.biShiftRight(n,1)).digits[0]&&0==o.biHighIndex(n))break;r=this.multiplyMod(r,r)}return e}if(void 0===t.RSAUtils)var o=t.RSAUtils={};var s,g,d,u,a=t.BigInt=function(i){this.digits="boolean"==typeof i&&1==i?null:g.slice(0),this.isNeg=!1};o.setMaxDigits=function(i){s=i,g=new Array(s);for(var t=0;t<g.length;t++)g[t]=0;d=new a,(u=new a).digits[0]=1},o.setMaxDigits(20);o.biFromNumber=function(i){var t=new a;t.isNeg=i<0,i=Math.abs(i);for(var e=0;i>0;)t.digits[e++]=65535&i,i=Math.floor(i/65536);return t};var l=o.biFromNumber(1e15);o.biFromDecimal=function(i){for(var t,e="-"==i.charAt(0),r=e?1:0;r<i.length&&"0"==i.charAt(r);)++r;if(r==i.length)t=new a;else{var n=(i.length-r)%15;for(0==n&&(n=15),t=o.biFromNumber(Number(i.substr(r,n))),r+=n;r<i.length;)t=o.biAdd(o.biMultiply(t,l),o.biFromNumber(Number(i.substr(r,15)))),r+=15;t.isNeg=e}return t},o.biCopy=function(i){var t=new a(!0);return t.digits=i.digits.slice(0),t.isNeg=i.isNeg,t},o.reverseStr=function(i){for(var t="",e=i.length-1;e>-1;--e)t+=i.charAt(e);return t};var f=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"];o.biToString=function(i,t){var e=new a;e.digits[0]=t;for(var r=o.biDivideModulo(i,e),n=f[r[1].digits[0]];1==o.biCompare(r[0],d);)r=o.biDivideModulo(r[0],e),digit=r[1].digits[0],n+=f[r[1].digits[0]];return(i.isNeg?"-":"")+o.reverseStr(n)},o.biToDecimal=function(i){var t=new a;t.digits[0]=10;for(var e=o.biDivideModulo(i,t),r=String(e[1].digits[0]);1==o.biCompare(e[0],d);)e=o.biDivideModulo(e[0],t),r+=String(e[1].digits[0]);return(i.isNeg?"-":"")+o.reverseStr(r)};var c=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];o.digitToHex=function(t){var e="";for(i=0;i<4;++i)e+=c[15&t],t>>>=4;return o.reverseStr(e)},o.biToHex=function(i){for(var t="",e=(o.biHighIndex(i),o.biHighIndex(i));e>-1;--e)t+=o.digitToHex(i.digits[e]);return t},o.charToHex=function(i){return i>=48&&i<=57?i-48:i>=65&&i<=90?10+i-65:i>=97&&i<=122?10+i-97:0},o.hexToDigit=function(i){for(var t=0,e=Math.min(i.length,4),r=0;r<e;++r)t<<=4,t|=o.charToHex(i.charCodeAt(r));return t},o.biFromHex=function(i){for(var t=new a,e=i.length,r=0;e>0;e-=4,++r)t.digits[r]=o.hexToDigit(i.substr(Math.max(e-4,0),Math.min(e,4)));return t},o.biFromString=function(i,t){var e="-"==i.charAt(0),r=e?1:0,n=new a,s=new a;s.digits[0]=1;for(var g=i.length-1;g>=r;g--){var d=i.charCodeAt(g),u=o.charToHex(d),l=o.biMultiplyDigit(s,u);n=o.biAdd(n,l),s=o.biMultiplyDigit(s,t)}return n.isNeg=e,n},o.biDump=function(i){return(i.isNeg?"-":"")+i.digits.join(" ")},o.biAdd=function(i,t){var e;if(i.isNeg!=t.isNeg)t.isNeg=!t.isNeg,e=o.biSubtract(i,t),t.isNeg=!t.isNeg;else{e=new a;for(var r,n=0,s=0;s<i.digits.length;++s)r=i.digits[s]+t.digits[s]+n,e.digits[s]=r%65536,n=Number(r>=65536);e.isNeg=i.isNeg}return e},o.biSubtract=function(i,t){var e;if(i.isNeg!=t.isNeg)t.isNeg=!t.isNeg,e=o.biAdd(i,t),t.isNeg=!t.isNeg;else{e=new a;var r,n;n=0;for(s=0;s<i.digits.length;++s)r=i.digits[s]-t.digits[s]+n,e.digits[s]=r%65536,e.digits[s]<0&&(e.digits[s]+=65536),n=0-Number(r<0);if(-1==n){n=0;for(var s=0;s<i.digits.length;++s)r=0-e.digits[s]+n,e.digits[s]=r%65536,e.digits[s]<0&&(e.digits[s]+=65536),n=0-Number(r<0);e.isNeg=!i.isNeg}else e.isNeg=i.isNeg}return e},o.biHighIndex=function(i){for(var t=i.digits.length-1;t>0&&0==i.digits[t];)--t;return t},o.biNumBits=function(i){var t,e=o.biHighIndex(i),r=i.digits[e],n=16*(e+1);for(t=n;t>n-16&&0==(32768&r);--t)r<<=1;return t},o.biMultiply=function(i,t){for(var e,r,n,s=new a,g=o.biHighIndex(i),d=o.biHighIndex(t),u=0;u<=d;++u){for(e=0,n=u,j=0;j<=g;++j,++n)r=s.digits[n]+i.digits[j]*t.digits[u]+e,s.digits[n]=65535&r,e=r>>>16;s.digits[u+g+1]=e}return s.isNeg=i.isNeg!=t.isNeg,s},o.biMultiplyDigit=function(i,t){var e,r,n;result=new a,e=o.biHighIndex(i),r=0;for(var s=0;s<=e;++s)n=result.digits[s]+i.digits[s]*t+r,result.digits[s]=65535&n,r=n>>>16;return result.digits[1+e]=r,result},o.arrayCopy=function(i,t,e,r,n){for(var o=Math.min(t+n,i.length),s=t,g=r;s<o;++s,++g)e[g]=i[s]};var h=[0,32768,49152,57344,61440,63488,64512,65024,65280,65408,65472,65504,65520,65528,65532,65534,65535];o.biShiftLeft=function(i,t){var e=Math.floor(t/16),r=new a;o.arrayCopy(i.digits,0,r.digits,e,r.digits.length-e);for(var n=t%16,s=16-n,g=r.digits.length-1,d=g-1;g>0;--g,--d)r.digits[g]=r.digits[g]<<n&65535|(r.digits[d]&h[n])>>>s;return r.digits[0]=r.digits[g]<<n&65535,r.isNeg=i.isNeg,r};var b=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535];o.biShiftRight=function(i,t){var e=Math.floor(t/16),r=new a;o.arrayCopy(i.digits,e,r.digits,0,i.digits.length-e);for(var n=t%16,s=16-n,g=0,d=g+1;g<r.digits.length-1;++g,++d)r.digits[g]=r.digits[g]>>>n|(r.digits[d]&b[n])<<s;return r.digits[r.digits.length-1]>>>=n,r.isNeg=i.isNeg,r},o.biMultiplyByRadixPower=function(i,t){var e=new a;return o.arrayCopy(i.digits,0,e.digits,t,e.digits.length-t),e},o.biDivideByRadixPower=function(i,t){var e=new a;return o.arrayCopy(i.digits,t,e.digits,0,e.digits.length-t),e},o.biModuloByRadixPower=function(i,t){var e=new a;return o.arrayCopy(i.digits,0,e.digits,0,t),e},o.biCompare=function(i,t){if(i.isNeg!=t.isNeg)return 1-2*Number(i.isNeg);for(var e=i.digits.length-1;e>=0;--e)if(i.digits[e]!=t.digits[e])return i.isNeg?1-2*Number(i.digits[e]>t.digits[e]):1-2*Number(i.digits[e]<t.digits[e]);return 0},o.biDivideModulo=function(i,t){var e,r,n=o.biNumBits(i),s=o.biNumBits(t),g=t.isNeg;if(n<s)return i.isNeg?((e=o.biCopy(u)).isNeg=!t.isNeg,i.isNeg=!1,t.isNeg=!1,r=biSubtract(t,i),i.isNeg=!0,t.isNeg=g):(e=new a,r=o.biCopy(i)),[e,r];e=new a,r=i;for(var d=Math.ceil(s/16)-1,l=0;t.digits[d]<32768;)t=o.biShiftLeft(t,1),++l,++s,d=Math.ceil(s/16)-1;r=o.biShiftLeft(r,l),n+=l;for(var f=Math.ceil(n/16)-1,c=o.biMultiplyByRadixPower(t,f-d);-1!=o.biCompare(r,c);)++e.digits[f-d],r=o.biSubtract(r,c);for(var h=f;h>d;--h){var b=h>=r.digits.length?0:r.digits[h],p=h-1>=r.digits.length?0:r.digits[h-1],v=h-2>=r.digits.length?0:r.digits[h-2],y=d>=t.digits.length?0:t.digits[d],x=d-1>=t.digits.length?0:t.digits[d-1];e.digits[h-d-1]=b==y?65535:Math.floor((65536*b+p)/y);for(var m=e.digits[h-d-1]*(65536*y+x),N=4294967296*b+(65536*p+v);m>N;)--e.digits[h-d-1],m=e.digits[h-d-1]*(65536*y|x),N=65536*b*65536+(65536*p+v);c=o.biMultiplyByRadixPower(t,h-d-1),(r=o.biSubtract(r,o.biMultiplyDigit(c,e.digits[h-d-1]))).isNeg&&(r=o.biAdd(r,c),--e.digits[h-d-1])}return r=o.biShiftRight(r,l),e.isNeg=i.isNeg!=g,i.isNeg&&(e=g?o.biAdd(e,u):o.biSubtract(e,u),t=o.biShiftRight(t,l),r=o.biSubtract(t,r)),0==r.digits[0]&&0==o.biHighIndex(r)&&(r.isNeg=!1),[e,r]},o.biDivide=function(i,t){return o.biDivideModulo(i,t)[0]},o.biModulo=function(i,t){return o.biDivideModulo(i,t)[1]},o.biMultiplyMod=function(i,t,e){return o.biModulo(o.biMultiply(i,t),e)},o.biPow=function(i,t){for(var e=u,r=i;;){if(0!=(1&t)&&(e=o.biMultiply(e,r)),0==(t>>=1))break;r=o.biMultiply(r,r)}return e},o.biPowMod=function(i,t,e){for(var r=u,n=i,s=t;;){if(0!=(1&s.digits[0])&&(r=o.biMultiplyMod(r,n,e)),0==(s=o.biShiftRight(s,1)).digits[0]&&0==o.biHighIndex(s))break;n=o.biMultiplyMod(n,n,e)}return r},t.BarrettMu=function(i){this.modulus=o.biCopy(i),this.k=o.biHighIndex(this.modulus)+1;var t=new a;t.digits[2*this.k]=1,this.mu=o.biDivide(t,this.modulus),this.bkplus1=new a,this.bkplus1.digits[this.k+1]=1,this.modulo=e,this.multiplyMod=r,this.powMod=n};var p=function(i,e,r){var n=o;this.e=n.biFromHex(i),this.d=n.biFromHex(e),this.m=n.biFromHex(r),this.chunkSize=2*n.biHighIndex(this.m),this.radix=16,this.barrett=new t.BarrettMu(this.m)};o.getKeyPair=function(i,t,e){return new p(i,t,e)},void 0===t.twoDigit&&(t.twoDigit=function(i){return(i<10?"0":"")+String(i)}),o.encryptedString=function(i,t){for(var e=[],r=t.length,n=0;n<r;)e[n]=t.charCodeAt(n),n++;for(;e.length%i.chunkSize!=0;)e[n++]=0;var s,g,d,u=e.length,l="";for(n=0;n<u;n+=i.chunkSize){for(d=new a,s=0,g=n;g<n+i.chunkSize;++s)d.digits[s]=e[g++],d.digits[s]+=e[g++]<<8;var f=i.barrett.powMod(d,i.e);l+=(16==i.radix?o.biToHex(f):o.biToString(f,i.radix))+" "}return l.substring(0,l.length-1)},o.decryptedString=function(i,t){var e,r,n,s=t.split(" "),g="";for(e=0;e<s.length;++e){var d;for(d=16==i.radix?o.biFromHex(s[e]):o.biFromString(s[e],i.radix),n=i.barrett.powMod(d,i.d),r=0;r<=o.biHighIndex(n);++r)g+=String.fromCharCode(255&n.digits[r],n.digits[r]>>8)}return 0==g.charCodeAt(g.length-1)&&(g=g.substring(0,g.length-1)),g},o.setMaxDigits(130)}(window),Safencrypt.startUp=function(i,t){var e=new Safencrypt;e.log("正在启动中...[author:1iURI]"),e.checkCToken()||(e.error("检测到当前浏览器未注册至服务器端，启动客户端注册机制..."),e.signUpClient(i,t))};